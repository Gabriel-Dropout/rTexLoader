# rTexLoader-cpp

This is a C++ single-header library for dynamically loading atlas data generated by `rTexPacker`. It requires `raylib`.

---

## Features

- Loads atlas image from a specified path and stores texture in the `atlas` global variable.
- Reads the `rTPb` chunk contained in the atlas PNG file and configures `spriteMap`.
- Sprite drawing functions

---

## Global Variables and Basic Functions

```C++
// Global variables
extern Texture atlas;
extern std::map<std::string, AtlasSprite> spriteMap;

// Load/Unload atlas and sprite map from file
void initAtlas(const char* filename);
void initAtlas(const std::string& filename);
void unloadAtlas();

// Get a sprite from the map by nameId
AtlasSprite& getAtlasSprite(const std::string& nameId);
AtlasSprite& getAtlasSprite(const std::string& nameId, int suffix);
AtlasSprite& getAtlasSprite(const std::string_view& nameId);
AtlasSprite& getAtlasSprite(const std::string_view& nameId, int suffix);
AtlasSprite& getAtlasSprite(const char* nameId);
AtlasSprite& getAtlasSprite(const char* nameId, int suffix);

// Aliases for getAtlasSprite
AtlasSprite& getSprite(const std::string& nameId);
AtlasSprite& getSprite(const std::string& nameId, int suffix);
AtlasSprite& getSprite(const std::string_view& nameId);
AtlasSprite& getSprite(const std::string_view& nameId, int suffix);
AtlasSprite& getSprite(const char* nameId);
AtlasSprite& getSprite(const char* nameId, int suffix);

// Draw a sprite from atlas
void DrawSpriteAtlas(const Texture2D &atlas, const AtlasSprite &sprite, int x, int y, Color color);
void DrawSpriteAtlas(const Texture2D &atlas, const AtlasSprite &sprite, int x, int y, float angle, Color color);
void DrawSpriteAtlas(const Texture2D &atlas, const AtlasSprite &sprite, int x, int y, float xscale, float yscale, float angle, Color color);
// warning: it ignores origin of sprite
void DrawSpriteAtlas(const Texture2D &atlas, const AtlasSprite &sprite, Rectangle slice, int x, int y, float xscale, float yscale, float angle, Color color);
```

---

## Usage Example

```C++
#include "raylib.h"
#define RTEXLOADER_IMPLEMENTATION
#include "rtexloader.hpp"

const int screenWidth = 640;
const int screenHeight = 480;

int main() {
    /// Initialization ///
    InitWindow(screenWidth, screenHeight, "atlas loading test");
    SetTargetFPS(60);
    initAtlas("atlas.png");
    
    /// Main game loop ///
    while (!WindowShouldClose()) {
        /// Update ///

        /// Draw ///
        BeginDrawing();
            ClearBackground(RAYWHITE);
            DrawSpriteAtlas(atlas, getSprite("image_name_without_extension"), 320, 240, WHITE);
        EndDrawing();
    }
    unloadAtlas();
}
```

---

## Example Build

You can use `CMake` to generate build files for the build systems you use. For example, if you're using `MinGW Makefiles`, you can do the following:

```bash
mkdir build && cd build
cmake .. -G "MinGW Makefiles"
make
cd example && ./main.exe
```

---

## Why RTEXLOADER_IMPLEMENTATION?

This is part of the library design. As `rTexLoader` is a single-header library, the entire implementation needs to be within the header file. Instead of inlining all the functions, some functions are declared as `extern` and their implementation is placed below `#ifdef RTEXLOADER_IMPLEMENTATION`.

By defining this macro in **only one** of the files that import `rTexLoader`, the definitions of these functions will be inserted into that file.

---

## Additional Notes

Currently, **this library only supports a single atlas.** If you want to implement multi-atlas support, feel free to send a pull request :)

The resources used in the `example` code are from `https://0x72.itch.io/dungeontileset-ii`.
